# TelegramBot
Реализация бота в Телеграм для практической тренировки изученного по Java/Spring/etc. Написан с использованием Spring Boot 2.7.1.

Бот писался для семейного канала в Телеграм и его отображение в ПО - кошка Шуша (@TheShushaBot). Поэтому многие реплики бота содержат слова типа "Мяу" и одна из
команд, которая прописана для бота - /stroke (погладить).

Команды, которые знает бот:

1. /start - просто вводная команда, аля приветствие.

2. /stroke - погладить. Первые четыре ввода приведут к разным ответам, последующие отправки - к повторению четвёртого ответа.

3. /weather <название города> - получение информации о погоде в городе на текущий момент.

4. /weatherf <название города> - получение прогноза погоды на последующие трое суток (текущие не входят в ответ). Как для данной команды, так и для предыдущей,
                                 данные запрашиваются с ресурса openweathermap.org.
                                 
5. /quiz <ключ> - викторина. Ввод без ключа запустит викторину. Ключи:
- help - помощь;
- exit - выход из Викторины с помощью аттрибута, для внештатных вариантов (штатный: кнопка в ответах Викторины);
- 0 - все записи по результатам по текущему пользователю;
- натуральные числа - вывод ТОП n результатов с сортировкой по убыванию, где n - указанное в ключе натуральное число.


Для хранения вопросов для викторины и таблица результатов используется БД PostgreSQL.

Особенности реализации:

а) Из двух вариантов, предоставляемых Telegram Bot API для получения обновлений, используется вариант с использованием Webhook. Регистрация webhook происходит
автоматически: т.е. не требуется отправки никаких дополнительных GET-запросов на https://api.telegram.org/.

б) Для проверки получения обновления именно от https://api.telegram.org/ используется функционал Telegram Bot API по установке доп.заголовка во входящих запросах, 
в котором указывается секретный ключ (прописывается в application.properties).

в) Для работы бота в application.properties должны быть ключи:
- для подключения соответствующей базы данных: spring.datasource.url, spring.datasource.driver-class-name, spring.datasource.username, spring.datasource.password.
- для данных по самому боту: bot.username (которое указали BotFather при регистрации, без @), bot.token (выдаёт BotFather при регистрации).
- для регистрации webhook: telegram.webhook.path (URL, на котором будет доступен бот), telegram.bot.path=/rest/v1/ (либо ставьте свой, но внесите правки в
TelegramBotRestController), telegram.webhook.secret.token (см. п/п б выше).
- telegram.bot.weather.apikey (получаете при регистрации на openweathermap.org), telegram.bot.weather.url=https://api.openweathermap.org/data/2.5/ (именно такой, 
если только openweathermap.org не поменяет).
